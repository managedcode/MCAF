<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Primary Meta Tags -->
  {% if page.is_home %}
  <title>{{ site.title }} - {{ site.tagline }}</title>
  <meta name="title" content="{{ site.title }} - {{ site.tagline }}">
  {% else %}
  <title>{{ page.title }} | {{ site.title }}</title>
  <meta name="title" content="{{ page.title }} | {{ site.title }}">
  {% endif %}
  <meta name="description" content="{{ page.description | default: site.description }}">
  <meta name="keywords" content="{{ page.keywords | default: site.keywords }}">
  <meta name="author" content="ManagedCode">
  <meta name="robots" content="index, follow">

  <!-- Canonical URL -->
  <link rel="canonical" href="{{ site.url }}{{ page.url }}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  {% if page.is_home %}
  <meta property="og:title" content="{{ site.title }} - {{ site.tagline }}">
  {% else %}
  <meta property="og:title" content="{{ page.title }} | {{ site.title }}">
  {% endif %}
  <meta property="og:description" content="{{ page.description | default: site.description }}">
  <meta property="og:image" content="{{ '/assets/images/og-image.png' | absolute_url }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="{{ site.title }}">
  <meta property="og:locale" content="en_US">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{{ site.url }}{{ page.url }}">
  {% if page.is_home %}
  <meta name="twitter:title" content="{{ site.title }} - {{ site.tagline }}">
  {% else %}
  <meta name="twitter:title" content="{{ page.title }} | {{ site.title }}">
  {% endif %}
  <meta name="twitter:description" content="{{ page.description | default: site.description }}">
  <meta name="twitter:image" content="{{ '/assets/images/og-image.png' | absolute_url }}">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="{{ '/assets/images/favicon.svg' | relative_url }}">

  <!-- Theme Color -->
  <meta name="theme-color" content="#785D8F">
  <meta name="msapplication-TileColor" content="#785D8F">

  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">

  <!-- Critical CSS inline -->
  <style>
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;margin:0;background:#fff}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:20px 60px;max-width:1280px;margin:0 auto}
    .main{max-width:860px;margin:0 auto;padding:40px 60px}
  </style>

  <!-- Stylesheet - non-blocking -->
  <link rel="preload" href="{{ '/assets/css/style.css' | relative_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}"></noscript>

  <!-- Fonts - non-blocking -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>

  <!-- Google tag (gtag.js) - GDPR-friendly without consent -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FMRJ311LEF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FMRJ311LEF', {
      'anonymize_ip': true,
      'cookie_expires': 0
    });
  </script>

  <!-- Structured Data for SEO & AI/LLM Discovery -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "{{ site.title }}",
    "alternateName": ["MCAF", "Managed Code Coding AI Framework"],
    "description": "{{ site.description }}",
    "url": "{{ site.url }}",
    "publisher": {
      "@type": "Organization",
      "name": "ManagedCode",
      "url": "https://managed-code.com"
    },
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ site.url }}/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareSourceCode",
    "name": "MCAF - Managed Code Coding AI Framework",
    "description": "Framework for building real production software with AI coding agents. Solves the problem of unpredictable AI output through structured context, automated tests as verification gates, and AGENTS.md instructions. Works with Claude Code, Codex, Gemini, ChatGPT, Cursor, GitHub Copilot.",
    "codeRepository": "https://github.com/managedcode/MCAF",
    "programmingLanguage": "Markdown",
    "runtimePlatform": "AI Coding Agents",
    "license": "https://creativecommons.org/licenses/by/4.0/",
    "author": {
      "@type": "Organization",
      "name": "ManagedCode",
      "url": "https://managed-code.com"
    },
    "keywords": ["MCAF", "Coding AI Framework", "AGENTS.md", "vibe coding", "AI-assisted development", "real software", "production code", "Claude Code", "Codex", "Gemini", "ChatGPT", "Cursor", "GitHub Copilot", "Windsurf", "Cline", "Aider"]
  }
  </script>
  {% if page.is_home %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "What is MCAF?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "MCAF (Managed Code Coding AI Framework) is a framework for building real production software with AI coding agents. Not prototypes - real products. It solves the problem of unpredictable AI output by defining structured context, using automated tests as verification gates, and encoding repository-specific rules in AGENTS.md."
        }
      },
      {
        "@type": "Question",
        "name": "What problem does MCAF solve?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "MCAF solves the problem of unpredictable and unreliable AI-generated code. Without structure, AI coding agents produce inconsistent results. MCAF provides three pillars: Context (all information in the repository), Verification (tests and static analysis as hard gates), and Instructions (AGENTS.md defines how AI agents work). This makes AI coding predictable, safe, and repeatable."
        }
      },
      {
        "@type": "Question",
        "name": "What is AGENTS.md?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "AGENTS.md is a file at the repository root that defines how AI coding agents work in a specific codebase. It contains commands for build, test, format, and analyze, coding rules, testing discipline, and maintainer preferences. AI agents read AGENTS.md before making changes to ensure consistent behavior."
        }
      },
      {
        "@type": "Question",
        "name": "How does MCAF enable safe vibe coding?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "MCAF makes vibe coding production-ready. While vibe coding means trusting AI and following the vibes, MCAF adds guardrails: automated tests verify behavior, static analysis catches issues, and AGENTS.md provides consistent instructions. You get the speed of vibe coding with the reliability needed for real software."
        }
      },
      {
        "@type": "Question",
        "name": "Which AI coding agents work with MCAF?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "MCAF works with any AI coding agent that can read repository files. Popular tools include Claude Code, Codex, Gemini, ChatGPT, Cursor, GitHub Copilot, Windsurf, Cline, Aider, and other LLM-based coding assistants. The framework is tool-agnostic - it defines how to work with AI, not which AI to use."
        }
      }
    ]
  }
  </script>
  {% endif %}
</head>
<body>
  <nav class="nav">
    <a href="{{ '/' | relative_url }}" class="nav-logo">{{ site.title }}</a>
    <div class="nav-links">
      <a href="{{ '/' | relative_url }}" {% if page.url == '/' %}class="active"{% endif %}>Guide</a>
      <a href="{{ '/tutorial' | relative_url }}" {% if page.url == '/tutorial.html' %}class="active"{% endif %}>Tutorial</a>
      <a href="{{ '/templates' | relative_url }}" {% if page.url == '/templates.html' %}class="active"{% endif %}>Templates</a>
      <a href="{{ '/credits' | relative_url }}" {% if page.url == '/credits.html' %}class="active"{% endif %}>Credits</a>
      <a href="https://github.com/managedcode/MCAF" target="_blank" rel="noopener">GitHub</a>
      <a href="https://managed-code.com" target="_blank" rel="noopener" class="nav-brand">ManagedCode</a>
      <label class="dark-toggle-label" title="Toggle dark mode">
        <input type="checkbox" id="dark-toggle">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </label>
    </div>
  </nav>

  <main class="main">
    <article class="content">
      {{ content }}
    </article>
  </main>

  <button class="back-to-top" id="back-to-top" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <footer class="footer">
    <div class="footer-container">
      <p>{{ site.title }} &copy; {{ 'now' | date: '%Y' }} by <a href="https://managed-code.com" target="_blank" rel="noopener">Managed Code</a></p>
      <p>Licensed under <a href="https://creativecommons.org/licenses/by/4.0/" rel="noopener">CC BY 4.0</a></p>
      <p class="footer-version">v{{ site.version }} Â· {{ site.build_date }}</p>
    </div>
  </footer>

  <!-- Scripts at end of body -->
  <script>
    // Dark mode - run immediately to prevent flash
    (function(){
      var d=document.body,t=document.getElementById('dark-toggle'),
          s=localStorage.getItem('darkMode'),
          p=window.matchMedia('(prefers-color-scheme:dark)').matches;
      if(s==='true'||(s===null&&p)){d.classList.add('dark');if(t)t.checked=true}
      if(t)t.onchange=function(){d.classList.toggle('dark');localStorage.setItem('darkMode',d.classList.contains('dark'))}
    })();
  </script>

  <!-- Deferred scripts -->
  <script defer>
    // Back to top
    var b=document.getElementById('back-to-top');
    window.onscroll=function(){b.classList.toggle('visible',window.scrollY>400)};
    b.onclick=function(){window.scrollTo({top:0,behavior:'smooth'})};

    // TOC navigation
    document.querySelectorAll('.toc a').forEach(function(l){
      l.onclick=function(e){
        e.preventDefault();
        var t=this.textContent.trim().toLowerCase();
        document.querySelectorAll('h2').forEach(function(h){
          if(h.textContent.toLowerCase().includes(t))h.scrollIntoView({behavior:'smooth',block:'start'})
        })
      }
    });

    // Copy code button
    document.querySelectorAll('pre').forEach(function(p){
      var b=document.createElement('button');
      b.className='copy-btn';b.textContent='Copy';
      b.onclick=function(){
        navigator.clipboard.writeText((p.querySelector('code')||p).textContent).then(function(){
          b.textContent='Copied!';setTimeout(function(){b.textContent='Copy'},2000)
        })
      };
      p.style.position='relative';p.appendChild(b)
    });
  </script>

</body>
</html>
